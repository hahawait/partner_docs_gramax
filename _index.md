---
order: 1
title: Руководство пользователя Партнерского АПИ
---

## Из чего состоит Партнерское АПИ:

-  Аутенфикация партнерского пользователя и связка с партнерским id аккаунта

-  Выбор каналов по которым требуется получение данных по событиям внутри них

-  Создание ссылок внутри канала и получение списка всех ссылок внутри канала

-  Получение событий по пулу каналов за определенный период времени

## Сущности

**partner_token** - токен партнера по которому происходит взаимодействие со всеми ендпоинтами API

**external_id** - id пользователя внутри партнерского приложения

**channel_id** - id канала внутри телеграмма. Пример: -1001123187485



## Путь пользователя на стороне интегратора:

1. Получение партнерского токена и указание доменов или ip адресов с которых будет вызывать АПИ

2. На первом этапе пользователь создает связку пользователя через аутенфикацию prizma.tools

   либо **soon** регистрация через oauth2.0 партнерской аутенфикации

   Для этого надо получить ссылку редирект на iframe или на другую страницу с помощью **/auth/auth-link**

   После связки проверить, что связь выполнена через **/auth/check-partner**

   Для связки надо передать партерский токен(**partner_token)** и id пользователя внутри вашей платформы\*\*(external_id)\*\*

   [openapi:./rukovodstvo-polzovatelya-partnerskogo-api.yaml:false]

3. На следующей этапе нужно указать по каким каналам пользователя можно получать события и создавать ссылки

   Для этого передаем партнерский токен(**partner_token)** и в body передать массив каналов в формате **channel_id,** также надо передать хотите ли “add” подписаться на события на нужном канале или наоборот перестать их получать, тогда передать “delete”.

   В обычном сценарии вам достаточно “add”

   [openapi:./rukovodstvo-polzovatelya-partnerskogo-api-2.yaml:false]

4. Далее вы можете проверить, установлены боты для сборки и создания ссылок

   У ботов есть сервисные имена:

   **collectorbot** - бот сборщик, отвечающий за сборку событий подписки и отписки в канале

   **helperbot** - бот, управляющий созданием ссылок

   Для получения статуса по ботам надо передать **partner_token** и \*\*external_id(\*\*любого связанного пользователя) и список каналов **channel_id** по которым нужна информация о ботах

   [openapi:./rukovodstvo-polzovatelya-partnerskogo-api-3.yaml:false]

5. Для создания ссылок и получения всех ссылок по каналу нужно воспользоваться двумя ендпоинтами:

   1. **/links** нужно передать **partner_token**,  **channel_id** канала в котором хотите создаться ссылку, **external_id** - пользователя от которого нужно создать ссылку (он должен быть связан с каналом в котором создается ссылка), также передается название ссылки **name**

      Необязательные параметры:

      1. creates_join_request - добавление пользователя администратором(только для закрытых каналов)

      2. expire_date - дата окончания действия ссылки

      3. member_limit - максимальное кол-во пользователей, которые могут подписаться по ссылке

      Возвращает такой JSON

      ```
      {
        "id": "0054970665c4bfdca81960165be906b5",
        "name": "testpartner",
        "channel_id": -10018085455036,
        "invite_link": "https://t.me/+CJTNbqdfKcNiMTBi",
        "creates_join_request": false,
        "expire_date": null,
        "member_limit": null,
        "created_at": "2025-03-13T14:47:00.468388Z",
        "updated_at": null,
        "is_bot_created": true,
        "creator_id": 3,
        "budget": 0,
        "tags": []
      }
      ```

      Где **id** это hash ссылки и уникальный индефикатор ссылки в prizma.tools

      **name** это название ссылки

      **invite_link** это сама пригласительная ссылка

      **created_at** - дата создание пригласительной ссылки

   2. [openapi:./rukovodstvo-polzovatelya-partnerskogo-api-4.yaml:false]

   3. **/links/all** нужно передать **partner_token, channel_id** канала в котором хотите создаться ссылку, **external_id** - любого пользователя, который привязан к партнеру

      **limit** и **offset** - для получения ссылок по странично, рекомендуемый limit не больше 1000

      [openapi:./rukovodstvo-polzovatelya-partnerskogo-api-5.yaml:false]

6. Получения событий по каналу:

   **/events/sub** и **/events/unsub** - ендпоинты для получения событий подписки на канал и событий отписки от канала соотвественно

   Надо передать **partner_token,** список каналов с **channels_id** по которым вы подписались получать данные, а также время старта **date_gte** и время окончания **date_lte** в таком формате

   **limit** и **offset** - для получения каналов по странично, рекомендуемый limit не больше 10000

   Возвращает по событийно с таким json:

   ```json
   {
         "oid": "fdb4079191638f6d58620f5c8c0522a8b42d3b623b7e9ad616b76135f8fdc32d",
         "channel_id": -1001133387485,
         "user_id": 1148998744396,
         "event_status": "subscribe",
         "invite_link": "9b902aa3e32e23fe590d6ba33a36964b",
         "is_premium": 0,
         "is_username": 0,
         "created_at": "2025-03-14T09:06:07Z"
   }
   ```

   Где **oid** - id события

   **channel_id** - id канала

   **user_id** - id пользователя в телеграмм, который совершил действие

   **event_status** - статус события подписки “subscribe” - подписка/ “unsubscribe” - отписка

   **invite_link** - hash ссылки канала, уникальный идентификатор ссылки. Получить это hash можно по формуле ниже

   **is_premium** - 1 если он премиум пользователь, 0 если нет

   **is_username** - 1 если есть юсернейм пользователя, 0 если нет

   **created_at** - время события

   [openapi:./rukovodstvo-polzovatelya-partnerskogo-api-6.yaml:false]

```python
import hashlib


def generate_link_id(channel_id: int, invite_link: str) -> str:
    shortened_link = invite_link[:22] + "..."
    val_to_hash = str(channel_id) + shortened_link
    return hashlib.md5(val_to_hash.encode()).hexdigest()
```

Т.е. это хеш md5 от строки из **channel_id** и обрезанной  ссылки формата [https://t.me/+CJTNbq](https://t.me/+CJTNbqdfKcNiMTBi), т.е. Первые 22 символа ссылки